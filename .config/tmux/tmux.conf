##### CORE BEHAVIOR & INPUT #####

# Enable mouse support (scroll, select panes, resize)
set -g mouse on

# Use vi-style keys in copy/scroll mode
set-window-option -g mode-keys vi


##### TERMINAL / UI CAPABILITIES #####

# Allow applications to detect when a tmux pane or window gains or loses focus
# Without this option, those programs behave as if they‚Äôre always focused, even when you switch windows.
# set-option -g focus-events on

# Advertise truecolor / extended terminal features
set-option -a terminal-features 'tmux-256color'
set -ag terminal-overrides ",xterm-256color:RGB"


##### WINDOW & PANE INDEXING #####

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1


##### PREFIX & SESSION BEHAVIOR #####

# Set new prefix key
set -g prefix C-a

# Do not exit tmux when the last session is closed
set -g detach-on-destroy off


##### KEY BINDINGS #####

# Reload tmux config without restarting
bind r source-file ~/.config/tmux/tmux.conf \; display "tmux config reloaded"

# Clear terminal like Ctrl+l
bind-key -n C-l send-keys C-l \; send-keys -R \; clear-history

# Kill pane immediately without confirmation
bind-key x kill-pane

# Move between panes using vi motions
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R


##### POPUPS / SESSION MANAGEMENT #####

# Tmux session picker (Alt + s) using sesh + fzf
bind-key -n M-s display-popup -E -w 40% -h 70% -T " sesh " sh -lc '
  sel="$(
    sesh list --icons | fzf \
      --no-sort --ansi \
      --border-label " sesh " \
      --prompt "‚ö°  " \
      --header "  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find" \
      --bind "esc:abort" \
      --bind "tab:down,btab:up" \
      --bind "ctrl-a:change-prompt(‚ö°  )+reload(sesh list --icons)" \
      --bind "ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t --icons)" \
      --bind "ctrl-g:change-prompt(‚öôÔ∏è  )+reload(sesh list -c --icons)" \
      --bind "ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z --icons)" \
      --bind "ctrl-f:change-prompt(üîé  )+reload(fd -H -d 2 -t d -E .Trash . ~)" \
      --bind "ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(‚ö°  )+reload(sesh list --icons)" \
      --preview-window "right:55%" \
      --preview "sesh preview {}"
  )" || exit 0

  [ -n "$sel" ] || exit 0
  sesh connect "$sel"
'


##### PLUGINS #####

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'

# Sensible defaults
set -g @plugin 'tmux-plugins/tmux-sensible'

# Seamless vim <-> tmux navigation
set -g @plugin 'christoomey/vim-tmux-navigator'


##### TPM INITIALIZATION (MUST BE LAST) #####

run '~/.config/tmux/plugins/tpm/tpm'

