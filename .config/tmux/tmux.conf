set -g mouse on
set-window-option -g mode-keys vi
set-option -g focus-events on
set-option -a terminal-features 'tmux-256color'
set -ag terminal-overrides ",xterm-256color:RGB"

# Start numbering windows at 1 instead of 0
set -g base-index 1
setw -g pane-base-index 1

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# vim-temux-nativator
set -g @plugin 'christoomey/vim-tmux-navigator'
# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'github_username/plugin_name#branch'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'

# Remove the default prefix
unbind C-b

# Set new prefix
set -g prefix C-a
bind C-a send-prefix

# Reload tmux config without restarting
bind r source-file ~/.config/tmux/tmux.conf \; display "tmux config reloaded"

# Cleaning the terminal like Ctrl + l
bind-key -n C-l send-keys C-l \; send-keys -R \; clear-history

bind-key x kill-pane # skip "kill-pane 1? (y/n)" prompt
set -g detach-on-destroy off  # don't exit from tmux when closing a session

# Tmux session picker using Meta + s (Alt + s)
# bind-key -n M-s display-popup -E -w 40% sh -lc 'sesh connect "$(sesh list -i | fzf --ansi)"'

bind-key -n M-s display-popup -E -w 40% -h 70% -T " sesh " sh -lc '
  sel="$(
    sesh list --icons | fzf \
      --no-sort --ansi \
      --border-label " sesh " \
      --prompt "âš¡  " \
      --header "  ^a all ^t tmux ^g configs ^x zoxide ^d tmux kill ^f find" \
      --bind "esc:abort" \
      --bind "tab:down,btab:up" \
      --bind "ctrl-a:change-prompt(âš¡  )+reload(sesh list --icons)" \
      --bind "ctrl-t:change-prompt(ğŸªŸ  )+reload(sesh list -t --icons)" \
      --bind "ctrl-g:change-prompt(âš™ï¸  )+reload(sesh list -c --icons)" \
      --bind "ctrl-x:change-prompt(ğŸ“  )+reload(sesh list -z --icons)" \
      --bind "ctrl-f:change-prompt(ğŸ”  )+reload(fd -H -d 2 -t d -E .Trash . ~)" \
      --bind "ctrl-d:execute(tmux kill-session -t {2..})+change-prompt(âš¡  )+reload(sesh list --icons)" \
      --preview-window "right:55%" \
      --preview "sesh preview {}"
  )" || exit 0

  [ -n "$sel" ] || exit 0
  sesh connect "$sel"
'
